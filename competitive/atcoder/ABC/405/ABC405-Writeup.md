[[累積和]]
# C - Sum of Product

## 問題概要

長さ $N$ の整数列 $A = (A\_1, A\_2, \dots, A\_N)$ が与えられる。
異なる 2 つの要素を選んで積を取り、それをすべてのペアについて合計せよ。

すなわち、次を求める：

$$
\sum_{1 \leq i < j \leq N} A_i \cdot A_j
$$

---

## 解法

### 1. 式変形

例えば $A = (a\_1, a\_2, a\_3, a\_4)$ の場合：

$$
a_1a_2 + a_1a_3 + a_1a_4 + a_2a_3 + a_2a_4 + a_3a_4
$$

これをまとめ直すと：

$$
a_1 (a_2 + a_3 + a_4) + a_2 (a_3 + a_4) + a_3 a_4
$$

一般に、

$$
\sum_{i=1}^N A_i \cdot \Bigl(\sum_{j=i+1}^N A_j\Bigr)
$$

と書ける。

---

### 2. 前計算による高速化

あらかじめ総和を

$$
S = \sum_{i=1}^N A_i
$$

としておく。

ループ中で `prefix` を管理し、

$$
\text{answer} = \sum_{i=1}^N A_i \cdot (S - \text{prefix} - A_i)
$$

の形で計算すればよい。

---

### 3. 実装ポイント

* 計算量は $O(N)$。
* 積の結果が大きくなる可能性があるため、答えは `long` 型で持つ。

---

## 関連アルゴリズム

* **累積和 (prefix sum)**
* **式変形による二重ループ削減**
  ($O(N^2) \to O(N)$ に高速化)

---
