# imos法（いもす法）

## 概要

**imos法**は、区間加算を高速に処理するための差分累積アルゴリズム。1回の区間更新を O(1)O(1) で行い、最終的に累積和で実値を得る。

## 手順

1. 区間 [l,r])[l, r]) に +x を加えたい場合：
    
    ```
    diff[l] += x
    diff[r+1] -= x
    ```
    
2. 最後に1回だけ累積処理：
    
    ```
    for i in range(1, n):
        diff[i] += diff[i-1]
    ```
    
3. diff[i] が最終的な値。
    

## 計算量

- 更新：1回あたり O(1)O(1)
    
- 累積：全体で O(N)O(N)
    
- 合計：O(N+Q)O(N+Q)（Q = 区間更新回数）
    

## 例

```
N=5, 区間加算: [1,3]+=2, [2,5]+=3
初期: 0 0 0 0 0
差分: +2 -2 +3 -3
累積: 2 5 5 3 0
```

## 2次元拡張（2D imos）

同様の考え方を2D配列に拡張：

```python
diff[x1][y1] += v
diff[x2+1][y1] -= v
diff[x1][y2+1] -= v
diff[x2+1][y2+1] += v
```

累積を横→縦方向に行うことで全体反映。

## 応用

- 区間加算・集計系問題（AtCoder ABC183 F など）
    
- 可視化・ヒートマップ生成
    
- 範囲塗りつぶし・範囲加算の高速処理