# オフセット管理（Offset Management）

## 概要

**オフセット管理**とは、配列・座標・インデックスなどの基準点からのズレ（オフセット）を整理して扱う手法。座標圧縮・シフト演算・差分計算などの文脈で用いられる。

## 用途

- 座標圧縮後のインデックス調整
    
- 範囲外アクセスの防止
    
- 動的配列や負のインデックスの管理
    
- スライディングウィンドウや2次元マップの位置補正
    

## 代表例

### 1. 座標圧縮でのオフセット

```python
coords = sorted(set(values))
offset = {x: i for i, x in enumerate(coords)}
idx = offset[value]
```

### 2. 負インデックス補正

配列インデックスが負になる場合、基準値をずらして保持：

```python
offset = abs(min_value)
arr = [0] * (max_value + offset + 1)
arr[x + offset] = 1
```

### 3. 差分配列での基点調整

`diff[l] += x`, `diff[r+1] -= x` のような場合、範囲を1-basedまたは0-basedに統一。

## 応用

- imos法や差分法の範囲外処理
    
- 2次元配列でのマイナス座標対応
    
- DP・グラフ探索の座標補正
    

## 注意

- 実装時に「オフセット適用箇所の一貫性」が重要。
    
- オフセットの重ね掛け（多段補正）を避けるため、基準点を明示的に管理すること。