# アセンブリ言語（x86-64）レジスタまとめ（簡易版・図解付き）

---

# 1. 汎用レジスタ（General Purpose Registers）

### ■ 略語の意味（重要）

| レジスタ | 略語の意味 | 役割（簡潔） |
|----------|-------------|--------------|
| **rax** | **A**ccumulator | 計算結果・関数戻り値 |
| **rbx** | **B**ase | 汎用（x86古来のベースレジスタ） |
| **rcx** | **C**ounter | ループカウンタ |
| **rdx** | **D**ata | 除算・乗算、システムコール引数 |
| **rsi** | **S**ource **I**ndex | データ読み出し元アドレス |
| **rdi** | **D**estination **I**ndex | データ書き込み先アドレス |
| **rsp** | **R**ack **P**ointer | スタックトップ |
| **rbp** | **B**ase **P**ointer | 関数フレーム基準 |
| **r8–r15** | 追加汎用レジスタ | x86-64で追加された拡張領域 |

---

# 2. 汎用レジスタの全体像（Mermaid 図）

```mermaid
flowchart LR
    subgraph Main[主要レジスタ]
        rax[rax<br>Accumulator]
        rbx[rbx<br>Base]
        rcx[rcx<br>Counter]
        rdx[rdx<br>Data]
        rsi[rsi<br>Source Index]
        rdi[rdi<br>Destination Index]
    end

    subgraph StackReg[スタック関連]
        rsp[rsp<br>Stack Pointer]
        rbp[rbp<br>Base Pointer]
    end

    subgraph ExtReg[拡張レジスタ x86-64]
        r8[r8]
        r9[r9]
        r10[r10]
        r11[r11]
        r12[r12]
        r13[r13]
        r14[r14]
        r15[r15]
    end
```

---

# 3. レジスタの階層構造（大小サイズの関係）

```mermaid
flowchart TD
    RAX[64bit: rax]
    EAX[32bit: eax]
    AX[16bit: ax]
    AL[8bit下位: al]
    AH[8bit上位: ah]

    RAX --> EAX --> AX --> AL
    AX --> AH
```

---

# 4. フラグレジスタ（RFLAGS）

```mermaid
flowchart LR
    ZF[ZF<br>Zero Flag]
    SF[SF<br>Sign Flag]
    CF[CF<br>Carry Flag]
    OF[OF<br>Overflow Flag]

    subgraph RFLAGS[フラグレジスタ]
        ZF --> SF --> CF --> OF
    end
```

---

# 5. RIP（次に実行する命令アドレス）

```mermaid
sequenceDiagram
    participant CPU
    participant MEM as メモリ

    CPU->>MEM: RIP が指すアドレスを読み取り
    MEM-->>CPU: 次の命令を取得
    CPU->>CPU: RIP += 命令サイズ
```

---

# 6. スタック動作（rsp / rbp）

```mermaid
flowchart TD
    A[push rax] -->|rsp -= 8| B[メモリへ保存]
    B --> C[pop rax]
    C -->|rsp += 8| D[復元される]
```

---

# 7. システムコールのレジスタ配置

```mermaid
flowchart LR
    rax_sys[rax = システムコール番号]

    rdi_a[rdi = arg1]
    rsi_a[rsi = arg2]
    rdx_a[rdx = arg3]
    r10_a[r10 = arg4]
    r8_a[r8 = arg5]
    r9_a[r9 = arg6]

    rax_sys --> rdi_a --> rsi_a --> rdx_a --> r10_a --> r8_a --> r9_a
```

---

# 8. 最小限覚えるべきまとめ（暗記用）

```
・rax：計算結果・戻り値
・rsp/rbp：関数とスタックの中心
・rsi/rdi：メモリアクセス
・rcx：カウンタで使われる
・cmp/test → ZF/SF/CF/OF → jz/jnz/jg/jl などの条件分岐へ
・syscall：rax=番号、引数 rdi→rsi→rdx→r10→r8→r9
```
