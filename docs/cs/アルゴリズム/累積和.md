# 累積和（Prefix Sum）

## 概要

**累積和（Prefix Sum）** は、配列の部分和を高速に求めるための前処理テクニック。部分区間 [l,r])[l, r]) の総和を O(1)O(1) で求められる。

## 手順

1. 累積配列を構築：
    
    ```python
    prefix[0] = 0
    for i in range(1, n+1):
        prefix[i] = prefix[i-1] + a[i-1]
    ```
    
2. 区間和計算：
    
    ```python
    sum(l, r) = prefix[r] - prefix[l-1]
    ```
    

## 計算量

- 前処理：O(N)O(N)
    
- クエリ：O(1)O(1)
    

## 応用

- 区間和・区間平均の高速計算
    
- imos法・差分配列の補助
    
- DP（累積遷移の高速化）
    
- 2次元累積和（画像処理・ヒートマップ）
    

## 2次元累積和

```python
S[x][y] = A[x][y] + S[x-1][y] + S[x][y-1] - S[x-1][y-1]
```

部分矩形和：

sum(x1,y1,x2,y2)=S[x2][y2]−S[x1−1][y2]−S[x2][y1−1]+S[x1−1][y1−1]\text{sum}(x1, y1, x2, y2) = S[x2][y2] - S[x1-1][y2] - S[x2][y1-1] + S[x1-1][y1-1]

## 注意

- インデックスのずれ（0-based / 1-based）に注意。
    
- 累積誤差やオーバーフローが問題となる場合、mod演算やlong型で管理する。